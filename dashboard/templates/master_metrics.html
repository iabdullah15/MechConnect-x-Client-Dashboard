{# --- Master metrics UI, UI-only (no data wiring yet) --- #}
<style>
  :root {
    --mc-primary: #007CC2;
    --mc-gray: #E8E8E8;
    --mc-bg: #F5F5F5;
  }
  body.bg-light { background-color: var(--mc-bg) !important; }

  /* KPI banner */
  .kpi-banner {
    background: var(--mc-primary);
    color: #fff;
    border-radius: .5rem;
    padding: 1.25rem 1.25rem;
  }
  .kpi-banner h1 { font-size: 2.75rem; margin: 0; }

  /* Card look (white) */
  .mc-card.card { background: #fff; }

  /* Keep Plotly on transparent bg to match cards */
  .plot-card .card-body { padding: 1rem 1rem 0.5rem 1rem; }
</style>

<div class="kpi-banner mb-4">
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
    <div>
      <h4 class="mb-1">Total Chats Initiated</h4>
      <h1 id="total-chats" class="fw-bold mb-0">0</h1>
    </div>
    <div class="text-end">
      <!-- optional secondary info later -->
    </div>
  </div>
</div>

{# ---------------- Top Diagnosed Vehicles ---------------- #}
<h3 class="h5 mb-3">Top Diagnosed Vehicles</h3>
<div class="row g-3">
  <div class="col-12 col-lg-6">
    <div class="card mc-card shadow-sm plot-card">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h4 class="h6 mb-0">Top Car Makes Diagnosed</h4>
          <select id="makes-window-dropdown" class="form-select form-select-sm" style="max-width: 160px">
            <option value="7d">Last 7 days</option>
            <option value="30d">Last 30 days</option>
            <option value="90d">Last 90 days</option>
            <option value="all" selected>All time</option>
          </select>
        </div>
        <div id="top-makes-chart" style="height:360px;"></div>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-6">
    <div class="card mc-card shadow-sm plot-card">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h4 class="h6 mb-0">Top 5 Car Models Diagnosed</h4>
          <select id="models-window-dropdown" class="form-select form-select-sm" style="max-width: 160px">
            <option value="7d">Last 7 days</option>
            <option value="30d">Last 30 days</option>
            <option value="90d">Last 90 days</option>
            <option value="all" selected>All time</option>
          </select>
        </div>
        <div id="top-models-chart" style="height:360px;"></div>
      </div>
    </div>
  </div>
</div>

{# ---------------- Common Issues and Parts ---------------- #}
<h3 class="h5 mt-4 mb-3">Common Issues and Parts</h3>
<div class="row g-3">
  <div class="col-12 col-lg-6">
    <div class="card mc-card shadow-sm plot-card">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h4 class="h6 mb-0">Top 5 Diagnosed Issues</h4>
          <select id="issues-window-dropdown" class="form-select form-select-sm" style="max-width: 160px">
            <option value="7d">Last 7 days</option>
            <option value="30d">Last 30 days</option>
            <option value="90d">Last 90 days</option>
            <option value="all" selected>All time</option>
          </select>
        </div>
        <div id="top-issues-chart" style="height:360px;"></div>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-6">
    <div class="card mc-card shadow-sm plot-card">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h4 class="h6 mb-0">Top Selling Parts (Most Clicked)</h4>
          <select id="parts-window-dropdown" class="form-select form-select-sm" style="max-width: 160px">
            <option value="7d">Last 7 days</option>
            <option value="30d">Last 30 days</option>
            <option value="90d">Last 90 days</option>
            <option value="all" selected>All time</option>
          </select>
        </div>
        <div id="top-parts-chart" style="height:360px;"></div>
      </div>
    </div>
  </div>
</div>

{# ---------------- Diagnostic Behavior ---------------- #}
<h3 class="h5 mt-4 mb-3">Diagnostic Behavior</h3>
<div class="row g-3">
  <div class="col-12 col-lg-4">
    <div class="card mc-card shadow-sm plot-card">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h4 class="h6 mb-0">Avg. Steps/Questions per Diagnosis</h4>
          <select id="steps-window-dropdown" class="form-select form-select-sm" style="max-width: 160px">
            <option value="7d" selected>Last 7 days</option>
            <option value="30d">Last 30 days</option>
            <option value="90d">Last 90 days</option>
            <option value="all">All time</option>
          </select>
        </div>
        <div id="avg-steps-chart" style="height:360px;"></div>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-4">
    <div class="card mc-card shadow-sm plot-card">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h4 class="h6 mb-0">Diagnostic Session Completion Rate</h4>
          <select id="completion-window-dropdown" class="form-select form-select-sm" style="max-width: 160px">
            <option value="7d">Last 7 days</option>
            <option value="30d">Last 30 days</option>
            <option value="90d">Last 90 days</option>
            <option value="all" selected>All time</option>
          </select>
        </div>
        <div id="completion-rate-chart" style="height:360px;"></div>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-4">
    <div class="card mc-card shadow-sm text-center" style="height: 420px;">
      <div class="card-body d-flex align-items-center justify-content-center">
        <div class="text-muted fst-italic">Coming Soon</div>
      </div>
    </div>
  </div>
</div>

{# ---------------- Avg. Diagnosis Time (full width) ---------------- #}
<div class="card mc-card shadow-sm mt-4 plot-card">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h4 class="h6 mb-0">Avg. Diagnosis Time</h4>
      <select id="time-window-dropdown" class="form-select form-select-sm" style="max-width: 160px">
        <option value="7d">Last 7 days</option>
        <option value="30d">Last 30 days</option>
        <option value="90d">Last 90 days</option>
        <option value="all" selected>All time</option>
      </select>
    </div>
    <div id="avg-diagnosis-time-chart" style="height:360px;"></div>
  </div>
</div>

{# ---------------- Temporal Metrics ---------------- #}
<h3 class="h5 mt-4 mb-3">Temporal Metrics</h3>
<div class="row g-3">
  <div class="col-12 col-lg-6">
    <div class="card mc-card shadow-sm plot-card">
      <div class="card-body">
        <h4 class="h6 mb-2">Hourly/Daily Active Users</h4>
        <div id="hourly-active-chart" style="height:360px;"></div>
      </div>
    </div>
  </div>
  <div class="col-12 col-lg-6">
    <div class="card mc-card shadow-sm plot-card">
      <div class="card-body">
        <h4 class="h6 mb-2">Most Active Days of the Week</h4>
        <div id="weekday-active-chart" style="height:360px;"></div>
      </div>
    </div>
  </div>
</div>

<script>
  // ---- Helpers to keep style consistent with your Dash app ----
  const MC_PRIMARY = '#007CC2';
  const MC_GRAY = '#E8E8E8';
  const baseLayout = {
    margin: {l: 40, r: 20, t: 20, b: 40},
    paper_bgcolor: 'rgba(0,0,0,0)',
    plot_bgcolor: 'rgba(0,0,0,0)',
    font: {family: 'Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif'}
  };

  function renderEmptyHorizontalBar(divId, title) {
    const data = [{x: [], y: [], type: 'bar', orientation: 'h', marker: {color: MC_GRAY}}];
    const layout = {...baseLayout, height: 360, title, yaxis: {autorange: 'reversed'}, bargap: 0.2, margin: {l: 140, r: 20, t: 20, b: 20}};
    Plotly.newPlot(divId, data, layout, {displayModeBar: false, responsive: true});
  }

  function renderEmptyVerticalBar(divId, title) {
    const data = [{x: [], y: [], type: 'bar', marker: {color: MC_GRAY}}];
    const layout = {...baseLayout, height: 360, title, margin: {l: 40, r: 20, t: 20, b: 40}};
    Plotly.newPlot(divId, data, layout, {displayModeBar: false, responsive: true});
  }

  function renderEmptyLine(divId, title, spline=false) {
    const data = [{x: [], y: [], type: 'scatter', mode: 'lines+markers', line: {color: MC_PRIMARY}, marker: {size: 4}}];
    const layout = {...baseLayout, height: 360, title, margin: {l: 40, r: 20, t: 20, b: 40}};
    if (spline) data[0].line.shape = 'spline';
    Plotly.newPlot(divId, data, layout, {displayModeBar: false, responsive: true});
  }

  // KPI (static for now)
  document.getElementById('total-chats').textContent = '0';

  // Render all placeholders now (we’ll swap to real data later)
  renderEmptyHorizontalBar('top-makes-chart', '');
  renderEmptyHorizontalBar('top-models-chart', '');
  renderEmptyHorizontalBar('top-issues-chart', '');
  renderEmptyHorizontalBar('top-parts-chart', '');
  renderEmptyLine('avg-steps-chart', '', false);
  renderEmptyVerticalBar('completion-rate-chart', '');
  renderEmptyLine('avg-diagnosis-time-chart', '', true);
  renderEmptyLine('hourly-active-chart', '', true);
  renderEmptyVerticalBar('weekday-active-chart', '');

  // NOTE: When we wire real data, we’ll replace newPlot with Plotly.react
  // and drop in traces matching the exact look from your Dash app (MC_GRAY fills, MC_PRIMARY accents, edge ticks, etc.).
</script>
